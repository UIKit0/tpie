macro(add_unittest NAME)
  add_executable(ut-${NAME} test_${NAME}.cpp)
  target_link_libraries(ut-${NAME} tpie ${Boost_LIBRARIES})
  set(MTESTS ${ARGV})
  list(REMOVE_AT MTESTS 0)
  foreach(TEST ${MTESTS})
    add_test(${NAME}_${TEST} ut-${NAME} ${TEST})
  endforeach(TEST)
endmacro(add_unittest)


add_unittest(array basic iterators memory bit_basic bit_iterators bit_memory)

add_executable(test_bte test_bte.cpp)
target_link_libraries(test_bte tpie)

add_executable(test_array test_array.cpp)
target_link_libraries(test_array tpie)

add_executable(test_simplequeue test_simpleqeue.cpp)
target_link_libraries(test_simplequeue tpie)

add_executable(streaming streaming.cpp)
target_link_libraries(streaming tpie)

add_executable(stream_test stream.cpp)
target_link_libraries(stream_test tpie)


if(NOT WIN32) 
set(BTES ${BTES} ufs mmap)
endif(NOT WIN32)
set(BTES ${BTES} ami_stream cache stdio)

add_test(streaming::stream_source--memory streaming stream_source memory)
add_test(streaming::stream_source::minimum_memory streaming stream_source minimum_memory)
add_test(streaming::stream_source::process streaming stream_source process)
add_test(streaming::stream_source::process_back streaming stream_source process_back)
add_test(streaming::stream_sink--memory streaming stream_sink memory)
add_test(streaming::stream_sink::minimum_memory streaming stream_sink minimum_memory)
add_test(streamirg::stream_sink--process streaming stream_sink process)
add_test(streaming::sort--memory streaming sort memory)
add_test(streaming::sort--minimum_memory streaming sort minimum_memory)
add_test(streaming::sort--process streaming sort process)
add_test(streaming::pull_sort--memory streaming pull_sort memory)
add_test(streaming::pull_sort--minimum_memory streaming pull_sort minimum_memory)
add_test(streaming::pull_sort--process streaming pull_sort process)
add_test(streaming::buffer--memory streaming buffer memory)
add_test(streaming::buffer--minimum_memory streaming buffer minimum_memory)
add_test(streaming::buffer--process streaming buffer process)
add_test(streaming::pull_buffer--memory streaming pull_buffer memory)
add_test(streaming::pull_buffer--minimum_memory streaming pull_buffer minimum_memory)
add_test(streaming::pull_buffer--process streaming pull_buffer process)
add_test(streaming--virtual--memory streaming virtual memory)
add_test(streaming--virtual--minimum_memory streaming virtual minimum_memory)
add_test(streaming--virtual--process streaming virtual process)

add_test(array_basic test_array basic)
add_test(array_iterators test_array iterators)
add_test(array_memory test_array memory)
add_test(simplequeue_basic test_simplequeue basic)
add_test(simplequeue_memory test_simplequeue memory)


#foreach(bte ${BTES})
#  foreach(test basic randomread array)
#    add_test(bte_${bte}_${test} test_bte ${bte} ${test})
#  endforeach(test)
#endforeach(bte)
add_test(streaming::push_block_buffer--memory streaming push_block_buffer memory)
add_test(streaming::push_block_buffer--minimum_memory streaming push_block_buffer minimum_memory)
add_test(streaming::push_block_buffer--process streaming push_block_buffer process)
add_test(streaming::pull_block_buffer--memory streaming pull_block_buffer memory)
add_test(streaming::pull_block_buffer--minimum_memory streaming pull_block_buffer minimum_memory)
add_test(streaming::pull_block_buffer--process streaming pull_block_buffer process)

add_test(file_accessor_stdio stream_test file_accessor_stdio)
add_test(file_stream stream_test file_stream)
add_test(substreams stream_test substreams)
#add_test(fd_file stream_test fd_file)
